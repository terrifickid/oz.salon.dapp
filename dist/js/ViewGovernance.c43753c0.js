"use strict";(self["webpackChunkSalon"]=self["webpackChunkSalon"]||[]).push([[563],{1677:function(t,e,s){s.d(e,{Z:function(){return i}});var o=s(6252);function l(t,e,s,l,r,n){const a=(0,o.up)("full-page");return(0,o.wg)(),(0,o.j4)(a,{ref:"fullpage",options:r.options,class:"pr-16"},{default:(0,o.w5)((()=>[(0,o.WI)(t.$slots,"default")])),_:3},8,["options"])}var r={data(){return{options:{licenseKey:"K9EP6-N164H-2BKM8-MJLGI-KSURM",controlArrows:!0,scrollBar:!1,scrollingSpeed:500,navigation:!0,navigationPosition:"right"}}},methods:{async next(){this.$refs.fullpage.api.moveSectionDown()},async resize(){console.log("resize!"),this.$refs.fullpage.api.fitToSection(),this.$refs.fullpage.api.reBuild()}},mounted(){console.log("mounted!")},unmounted(){window.removeEventListener("resize",this.resize)}},n=s(3744);const a=(0,n.Z)(r,[["render",l]]);var i=a},595:function(t,e,s){s.r(e),s.d(e,{default:function(){return Z}});var o=s(6252),l=s(3577);const r=t=>((0,o.dD)("data-v-330dfb4f"),t=t(),(0,o.Cn)(),t),n=r((()=>(0,o._)("div",{class:"pt-24 text-center w-full absolute z-40 keyboard-off font-haffer"},[(0,o._)("select",{class:"text-right p-2 font-bold"},[(0,o._)("option",null,"Active"),(0,o._)("option",null,"Completed")])],-1))),a={class:"grid grid-cols-12 w-full gap-3 px-3",style:{height:"50vh"}},i={class:"col-span-6 sm:col-span-4 lg:col-span-3 xl:col-span-2"},d={class:"uppercase"},c=r((()=>(0,o._)("br",null,null,-1))),p={class:"mt-3"},u={class:"col-span-6 sm:col-span-8 lg:col-span-9 xl:col-span-10"},h={style:{height:"50vh",overflow:"scroll"}},v={style:{height:"50vh",width:"100rem"}},f=r((()=>(0,o._)("br",null,null,-1)));function g(t,e,s,r,g,w){const m=(0,o.up)("AppButtonVote"),y=(0,o.up)("CounterVote"),b=(0,o.up)("AppFullpage"),k=(0,o.up)("AppShell");return(0,o.wg)(),(0,o.j4)(k,{colors:g.colors,isLoaded:g.loaded,protected:!0,class:"font-haffer"},{default:(0,o.w5)((()=>[n,(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(g.proposals,((t,e)=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"section"},[(0,o._)("div",a,[(0,o._)("div",i,[(0,o._)("b",d,(0,l.zw)(t.contentType),1),c,(0,o.Uk)(" "+(0,l.zw)(t.id)+" ",1),(0,o._)("p",p,[(0,o.Wm)(m,{id:t.id,votes:t.votes,choice:!0,label:"Yes",class:"mr-2"},null,8,["id","votes"]),(0,o.Wm)(m,{id:t.id,votes:t.votes,choice:!1,label:"No"},null,8,["id","votes"]),(0,o.Wm)(y,{votes:t.votes,weights:this.weights},null,8,["votes","weights"])])]),(0,o._)("div",u,[(0,o._)("div",h,[(0,o._)("div",v,[(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.fields,((t,e)=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:"inline-block mr-5 mb-5 text-sm"},[(0,o._)("b",null,(0,l.zw)(t.label),1),f,(0,o.Uk)((0,l.zw)(t.value),1)])))),128))])])])])])])))),128))])),_:1})])),_:1},8,["colors","isLoaded"])}var w=s(9669),m=s.n(w);const y={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},b=(0,o._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1),k=[b];function _(t,e,s,r,n,a){const i=(0,o.up)("AppButton");return(0,o.wg)(),(0,o.j4)(i,{onClick:e[0]||(e[0]=t=>a.vote()),disabled:n.processing},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(s.label)+" ",1),a.voted?((0,o.wg)(),(0,o.iD)("svg",y,k)):(0,o.kq)("",!0)])),_:1},8,["disabled"])}var A=s(7175),S={components:{AppButton:A.Z},props:["id","votes","choice","label"],data(){return{processing:!1}},computed:{walletAddress(){return this.$store.state.walletAddress},voted(){if(!this.votes)return!1;var t=!1;return"en-US"in this.votes&&this.votes["en-US"].votes.forEach((e=>{e.address==this.walletAddress&&e.vote&&(t=!0)})),t}},methods:{async vote(){const t=JSON.stringify({address:this.walletAddress,vote:this.choice,proposal:this.id});try{const e=await this.$store.state.signer.signMessage(t);console.log("Sending Vote!");const s=await m().post("https://salontest-terrifickid.cloud.okteto.net/vote/"+this.id,{address:this.walletAddress,vote:t,signature:e});console.log(s.data),location.reload()}catch(e){console.log(e)}}}},z=s(3744);const x=(0,z.Z)(S,[["render",_]]);var N=x;const W={class:"text-xs"},U={class:"bg-black w-full relative my-3",style:{height:"2px"}};function T(t,e,s,r,n,a){return(0,o.wg)(),(0,o.iD)("div",W,[(0,o._)("div",U,[(0,o._)("div",{class:"bg-green-400 absolute z-20",style:(0,l.j5)([{height:"2px"},{width:a.percentageYes+"%"}])},null,4),(0,o._)("div",{class:"bg-red-400 absolute z-10",style:(0,l.j5)([{height:"2px"},{width:a.percentageYes+a.percentageNo+"%"}])},null,4)]),(0,o._)("div",null,"Total Votes: "+(0,l.zw)(a.total),1),(0,o._)("div",null,"Yes: "+(0,l.zw)(a.yesTotal),1),(0,o._)("div",null,"No: "+(0,l.zw)(a.noTotal),1)])}var j={props:["votes","weights"],computed:{total(){return this.votes.votes.length},yesTotal(){return this.votes.votes.filter((t=>{var e=JSON.parse(t.vote);if(e.vote)return!0})).length},noTotal(){return this.votes.votes.filter((t=>{var e=JSON.parse(t.vote);if(!e.vote)return!0})).length},w(){var t={};for(let e of this.weights)t[e.fields.walletAddress]=e.fields.units;return t},totalUnits(){var t=0;return Object.values(this.w).forEach((e=>t=parseInt(t)+parseInt(e))),t},wNormal(){var t=.1*this.totalUnits,e={};for(let s of this.weights)e[s.fields.walletAddress]=s.fields.units,s.fields.units>t&&(e[s.fields.walletAddress]=t);return e},yesWeight(){var t=0,e=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote&&(t=parseInt(t)+parseInt(e.wNormal[o.address]))})),t},noWeight(){var t=0,e=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote||(t=parseInt(t)+parseInt(e.wNormal[o.address]))})),t},percentageYes(){return this.totalUnits&&this.yesWeight?Math.round(this.totalUnits/this.yesWeight):0},percentageNo(){return this.totalUnits&&this.noWeight?Math.round(this.totalUnits/this.noWeight):0}}};const I=(0,z.Z)(j,[["render",T]]);var B=I,C=s(542),D=s(1677),M={components:{AppFullpage:D.Z,AppShell:C.Z,AppButtonVote:N,CounterVote:B},data(){return{colors:["white","black"],proposals:[],weights:[],types:["collect","invest","propose","sell","transfer"],loaded:!1}},computed:{},methods:{async getWeights(){try{const t=await m().get("https://salontest-terrifickid.cloud.okteto.net/members");this.weights=t.data}catch(t){console.log("error",t)}},getFieldLabel(t,e){for(let s of t)if(s.id==e)return s.name},async assembleProposalType(t){var e=["https://salontest-terrifickid.cloud.okteto.net/type/"+t,"https://salontest-terrifickid.cloud.okteto.net/form/"+t],s=this;try{var o=[],l=await Promise.all(e.map((t=>m().get(t))));for(const t of Object.values(l[0].data.message.items)){var r={votes:[]};"votes"in t.fields&&(r=t.fields.votes,delete t.fields.votes);var n=await Object.entries(t.fields).map((function(t){var e=s.getFieldLabel(l[1].data.fields,t[0]);return{label:e,value:t[1]}})),a={id:t.sys.id,createdAt:t.sys.createdAt,contentType:t.sys.contentType.sys.id,votes:r,fields:n};o.push(a)}return o}catch(i){return console.error(i),[]}}},async beforeMount(){console.log("proposals load!");var t=await Promise.all(this.types.map((t=>this.assembleProposalType(t))));this.proposals=t.flat(),await this.getWeights(),this.loaded=!0,console.log("loaded!"),console.log(this.proposals)}};const O=(0,z.Z)(M,[["render",g],["__scopeId","data-v-330dfb4f"]]);var Z=O}}]);
//# sourceMappingURL=ViewGovernance.c43753c0.js.map