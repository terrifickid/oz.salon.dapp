"use strict";(self["webpackChunkSalon"]=self["webpackChunkSalon"]||[]).push([[563],{1677:function(e,t,s){s.d(t,{Z:function(){return i}});var o=s(6252);function l(e,t,s,l,a,n){const r=(0,o.up)("full-page");return(0,o.wg)(),(0,o.j4)(r,{ref:"fullpage",options:a.options,class:"pr-16"},{default:(0,o.w5)((()=>[(0,o.WI)(e.$slots,"default")])),_:3},8,["options"])}var a={data(){return{options:{licenseKey:"K9EP6-N164H-2BKM8-MJLGI-KSURM",controlArrows:!0,scrollBar:!1,scrollingSpeed:500,navigation:!0,navigationPosition:"right"}}},methods:{async next(){this.$refs.fullpage.api.moveSectionDown()},async resize(){console.log("resize!"),this.$refs.fullpage.api.fitToSection(),this.$refs.fullpage.api.reBuild()}},mounted(){console.log("mounted!")},unmounted(){window.removeEventListener("resize",this.resize)}},n=s(3744);const r=(0,n.Z)(a,[["render",l]]);var i=r},873:function(e,t,s){s.r(t),s.d(t,{default:function(){return E}});var o=s(6252),l=s(3577);const a=e=>((0,o.dD)("data-v-85cbe3e4"),e=e(),(0,o.Cn)(),e),n=a((()=>(0,o._)("div",{class:"pt-24 text-center w-full absolute z-40 keyboard-off font-haffer"},[(0,o._)("select",{class:"text-right p-2 font-bold"},[(0,o._)("option",null,"Active"),(0,o._)("option",null,"Completed")])],-1))),r={class:"grid grid-cols-12 w-full gap-3 px-3",style:{height:"50vh"}},i={class:"col-span-6 sm:col-span-4 lg:col-span-3 xl:col-span-2"},d={class:"uppercase"},c=a((()=>(0,o._)("br",null,null,-1))),u={class:"mt-3 flex"},p={class:"col-span-6 sm:col-span-8 lg:col-span-9 xl:col-span-10"},h=a((()=>(0,o._)("br",null,null,-1)));function v(e,t,s,a,v,g){const f=(0,o.up)("CounterVote"),w=(0,o.up)("AppCountdown"),m=(0,o.up)("AppButtonVote"),y=(0,o.up)("AppFullpage"),b=(0,o.up)("AppShell");return(0,o.wg)(),(0,o.j4)(b,{colors:v.colors,isLoaded:v.loaded,protected:!0,class:"font-haffer"},{default:(0,o.w5)((()=>[n,(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.proposals,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:"section"},[(0,o._)("div",r,[(0,o._)("div",i,[(0,o._)("b",d,(0,l.zw)(e.contentType),1),c,(0,o.Uk)(" "+(0,l.zw)(e.id)+" ",1),(0,o.Wm)(f,{votes:e.votes,weights:this.weights},null,8,["votes","weights"]),(0,o.Wm)(w,{start:e.createdAt,class:"mt-2"},null,8,["start"]),(0,o._)("div",u,[(0,o.Wm)(m,{id:e.id,votes:e.votes,choice:!0,label:"Yes",class:"mr-2"},null,8,["id","votes"]),(0,o.Wm)(m,{id:e.id,votes:e.votes,choice:!1,label:"No"},null,8,["id","votes"])])]),(0,o._)("div",p,[(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.fields,((e,t)=>((0,o.wg)(),(0,o.iD)("li",{key:t,class:"mr-5 mb-5 text-sm text-right"},[(0,o._)("b",null,(0,l.zw)(e.label),1),h,(0,o.Uk)((0,l.zw)(e.value),1)])))),128))])])])])))),128))])),_:1})])),_:1},8,["colors","isLoaded"])}var g=s(9669),f=s.n(g);const w=e=>((0,o.dD)("data-v-203bd7e2"),e=e(),(0,o.Cn)(),e),m={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},y=w((()=>(0,o._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1))),b=[y];function _(e,t,s,a,n,r){const i=(0,o.up)("AppButton");return(0,o.wg)(),(0,o.j4)(i,{onClick:t[0]||(t[0]=e=>r.vote()),disabled:n.processing,class:(0,l.C_)(["flex items-center",{active:r.voted}])},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(s.label)+" ",1),r.voted?((0,o.wg)(),(0,o.iD)("svg",m,b)):(0,o.kq)("",!0)])),_:1},8,["disabled","class"])}var A=s(7175),k={components:{AppButton:A.Z},props:["id","votes","choice","label"],data(){return{processing:!1}},computed:{walletAddress(){return this.$store.state.walletAddress},voted(){if(!this.votes)return!1;var e=!1;return this.votes.votes.forEach((t=>{var s=JSON.parse(t.vote);s.address==this.walletAddress&&s.vote==this.choice&&(e=!0)})),e}},methods:{async vote(){const e=JSON.stringify({address:this.walletAddress,vote:this.choice,proposal:this.id});try{const t=await this.$store.state.signer.signMessage(e);console.log("Sending Vote!");const s=await f().post("https://salontest-terrifickid.cloud.okteto.net/vote/"+this.id,{address:this.walletAddress,vote:e,signature:t});console.log(s.data),location.reload()}catch(t){console.log(t)}}}},x=s(3744);const z=(0,x.Z)(k,[["render",_],["__scopeId","data-v-203bd7e2"]]);var D=z;const S={class:"text-xs"},W={class:"bg-black w-full relative my-3",style:{height:"2px"}};function N(e,t,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",S,[(0,o._)("div",W,[(0,o._)("div",{class:"bg-green-400 absolute z-20",style:(0,l.j5)([{height:"2px"},{width:r.percentageYes+"%"}])},null,4),(0,o._)("div",{class:"bg-red-400 absolute z-10",style:(0,l.j5)([{height:"2px"},{width:r.percentageYes+r.percentageNo+"%"}])},null,4)]),(0,o._)("div",null,"Total Votes: "+(0,l.zw)(r.total),1),(0,o._)("div",null,"Yes: "+(0,l.zw)(r.yesTotal),1),(0,o._)("div",null,"No: "+(0,l.zw)(r.noTotal),1)])}var T={props:["votes","weights"],computed:{total(){return this.votes.votes.length},yesTotal(){return this.votes.votes.filter((e=>{var t=JSON.parse(e.vote);if(t.vote)return!0})).length},noTotal(){return this.votes.votes.filter((e=>{var t=JSON.parse(e.vote);if(!t.vote)return!0})).length},w(){var e={};for(let t of this.weights)e[t.fields.walletAddress]=t.fields.units;return e},totalUnits(){var e=0;return Object.values(this.w).forEach((t=>e=parseInt(e)+parseInt(t))),e},wNormal(){var e=.1*this.totalUnits,t={};for(let s of this.weights)t[s.fields.walletAddress]=s.fields.units,s.fields.units>e&&(t[s.fields.walletAddress]=e);return t},yesWeight(){var e=0,t=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote&&(e=parseInt(e)+parseInt(t.wNormal[o.address]))})),e},noWeight(){var e=0,t=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote||(e=parseInt(e)+parseInt(t.wNormal[o.address]))})),e},percentageYes(){return this.totalUnits&&this.yesWeight?Math.round(this.yesWeight/this.totalUnits*100):0},percentageNo(){return this.totalUnits&&this.noWeight?Math.round(this.noWeight/this.totalUnits*100):0}}};const C=(0,x.Z)(T,[["render",N]]);var U=C;const I={class:"text-xs"};function j(e,t,s,a,n,r){const i=(0,o.up)("vue-countdown");return(0,o.wg)(),(0,o.iD)("div",I,[(0,o.Wm)(i,{time:this.time},{default:(0,o.w5)((({days:e,hours:t,minutes:s,seconds:a})=>[(0,o.Uk)(" Time Remainingï¼š"+(0,l.zw)(e)+" days, "+(0,l.zw)(t)+" hours, "+(0,l.zw)(s)+" minutes, "+(0,l.zw)(a)+" seconds. ",1)])),_:1},8,["time"])])}var O={props:["start"],computed:{startDate(){return new Date(this.start)},endDate(){const e=new Date;return e.setDate(this.startDate.getDate()+4),e},time(){var e=new Date;return this.endDate.getTime()-e.getTime()}}};const Z=(0,x.Z)(O,[["render",j]]);var B=Z,M=s(5869),J=s(1677),L={components:{AppFullpage:J.Z,AppShell:M.Z,AppButtonVote:D,CounterVote:U,AppCountdown:B},data(){return{colors:["white","black"],proposals:[],weights:[],types:["collect","invest","propose","sell","transfer","onboard"],loaded:!1}},computed:{},methods:{async getWeights(){try{const e=await f().get("https://salon-node.salondao.xyz/members?cache=true");this.weights=e.data}catch(e){console.log("error",e)}},getFieldLabel(e,t){for(let s of e)if(s.id==t)return s.name},async assembleProposalType(e){var t=["https://salon-node.salondao.xyz/type/"+e+"?cache=true","https://salon-node.salondao.xyz/form/"+e+"?cache=true"],s=this;try{var o=[],l=await Promise.all(t.map((e=>f().get(e))));for(const e of Object.values(l[0].data.message.items)){var a={votes:[]};"votes"in e.fields&&(a=e.fields.votes,delete e.fields.votes);var n=await Object.entries(e.fields).map((function(e){var t=s.getFieldLabel(l[1].data.fields,e[0]);return{label:t,value:e[1]}})),r={id:e.sys.id,createdAt:e.sys.createdAt,contentType:e.sys.contentType.sys.id,votes:a,fields:n};o.push(r)}return o}catch(i){return console.error(i),[]}}},async beforeMount(){console.log("proposals load!");var e=await Promise.all(this.types.map((e=>this.assembleProposalType(e))));this.proposals=e.flat(),await this.getWeights(),this.loaded=!0,console.log("loaded!"),console.log(this.proposals)}};const Y=(0,x.Z)(L,[["render",v],["__scopeId","data-v-85cbe3e4"]]);var E=Y}}]);
//# sourceMappingURL=ViewGovernance.2a3398e3.js.map