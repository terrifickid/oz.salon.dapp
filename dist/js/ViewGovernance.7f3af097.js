"use strict";(self["webpackChunkSalon"]=self["webpackChunkSalon"]||[]).push([[563],{1677:function(t,e,s){s.d(e,{Z:function(){return i}});var o=s(6252);function l(t,e,s,l,a,r){const n=(0,o.up)("full-page");return(0,o.wg)(),(0,o.j4)(n,{ref:"fullpage",options:a.options,class:"pr-16"},{default:(0,o.w5)((()=>[(0,o.WI)(t.$slots,"default")])),_:3},8,["options"])}var a={data(){return{options:{licenseKey:"K9EP6-N164H-2BKM8-MJLGI-KSURM",controlArrows:!0,scrollBar:!1,scrollingSpeed:500,navigation:!0,navigationPosition:"right"}}},methods:{async next(){this.$refs.fullpage.api.moveSectionDown()},async resize(){console.log("resize!"),this.$refs.fullpage.api.fitToSection(),this.$refs.fullpage.api.reBuild()}},mounted(){console.log("mounted!")},unmounted(){window.removeEventListener("resize",this.resize)}},r=s(3744);const n=(0,r.Z)(a,[["render",l]]);var i=n},5987:function(t,e,s){s.r(e),s.d(e,{default:function(){return M}});var o=s(6252),l=s(3577);const a=t=>((0,o.dD)("data-v-115861e8"),t=t(),(0,o.Cn)(),t),r=a((()=>(0,o._)("div",{class:"pt-24 text-center w-full absolute z-40 keyboard-off font-haffer"},[(0,o._)("select",{class:"text-right p-2 font-bold"},[(0,o._)("option",null,"Active"),(0,o._)("option",null,"Completed")])],-1))),n={class:"grid grid-cols-12 w-full gap-3 px-3",style:{height:"50vh"}},i={class:"col-span-6 sm:col-span-4 lg:col-span-3 xl:col-span-2"},d={class:"uppercase"},c=a((()=>(0,o._)("br",null,null,-1))),u={class:"mt-3 flex"},p={class:"col-span-6 sm:col-span-8 lg:col-span-9 xl:col-span-10"},h=a((()=>(0,o._)("br",null,null,-1)));function v(t,e,s,a,v,g){const f=(0,o.up)("CounterVote"),w=(0,o.up)("AppCountdown"),m=(0,o.up)("AppButtonVote"),y=(0,o.up)("AppFullpage"),_=(0,o.up)("AppShell");return(0,o.wg)(),(0,o.j4)(_,{colors:v.colors,isLoaded:v.loaded,protected:!0,class:"font-haffer"},{default:(0,o.w5)((()=>[r,(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.proposals,((t,e)=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"section"},[(0,o._)("div",n,[(0,o._)("div",i,[(0,o._)("b",d,(0,l.zw)(t.contentType),1),c,(0,o.Uk)(" "+(0,l.zw)(t.id)+" ",1),(0,o.Wm)(f,{votes:t.votes,weights:this.weights},null,8,["votes","weights"]),(0,o.Wm)(w,{start:t.createdAt,class:"mt-2"},null,8,["start"]),(0,o._)("div",u,[(0,o.Wm)(m,{id:t.id,votes:t.votes,choice:!0,label:"Yes",class:"mr-2"},null,8,["id","votes"]),(0,o.Wm)(m,{id:t.id,votes:t.votes,choice:!1,label:"No"},null,8,["id","votes"])])]),(0,o._)("div",p,[(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.fields,((t,e)=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:"mr-5 mb-5 text-sm text-right"},[(0,o._)("b",null,(0,l.zw)(t.label),1),h,(0,o.Uk)((0,l.zw)(t.value),1)])))),128))])])])])))),128))])),_:1})])),_:1},8,["colors","isLoaded"])}var g=s(9669),f=s.n(g);const w=t=>((0,o.dD)("data-v-203bd7e2"),t=t(),(0,o.Cn)(),t),m={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},y=w((()=>(0,o._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1))),_=[y];function b(t,e,s,a,r,n){const i=(0,o.up)("AppButton");return(0,o.wg)(),(0,o.j4)(i,{onClick:e[0]||(e[0]=t=>n.vote()),disabled:r.processing,class:(0,l.C_)(["flex items-center",{active:n.voted}])},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(s.label)+" ",1),n.voted?((0,o.wg)(),(0,o.iD)("svg",m,_)):(0,o.kq)("",!0)])),_:1},8,["disabled","class"])}var A=s(7175),k={components:{AppButton:A.Z},props:["id","votes","choice","label"],data(){return{processing:!1}},computed:{walletAddress(){return this.$store.state.walletAddress},voted(){if(!this.votes)return!1;var t=!1;return this.votes.votes.forEach((e=>{var s=JSON.parse(e.vote);s.address==this.walletAddress&&s.vote==this.choice&&(t=!0)})),t}},methods:{async vote(){const t=JSON.stringify({address:this.walletAddress,vote:this.choice,proposal:this.id});try{const e=await this.$store.state.signer.signMessage(t);console.log("Sending Vote!");const s=await f().post("https://salontest-terrifickid.cloud.okteto.net/vote/"+this.id,{address:this.walletAddress,vote:t,signature:e});console.log(s.data),location.reload()}catch(e){console.log(e)}}}},D=s(3744);const x=(0,D.Z)(k,[["render",b],["__scopeId","data-v-203bd7e2"]]);var z=x;const N={class:"text-xs"},S={class:"bg-black w-full relative my-3",style:{height:"2px"}};function U(t,e,s,a,r,n){return(0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("div",S,[(0,o._)("div",{class:"bg-green-400 absolute z-20",style:(0,l.j5)([{height:"2px"},{width:n.percentageYes+"%"}])},null,4),(0,o._)("div",{class:"bg-red-400 absolute z-10",style:(0,l.j5)([{height:"2px"},{width:n.percentageYes+n.percentageNo+"%"}])},null,4)]),(0,o._)("div",null,"Total Votes: "+(0,l.zw)(n.total),1),(0,o._)("div",null,"Yes: "+(0,l.zw)(n.yesTotal),1),(0,o._)("div",null,"No: "+(0,l.zw)(n.noTotal),1)])}var W={props:["votes","weights"],computed:{total(){return this.votes.votes.length},yesTotal(){return this.votes.votes.filter((t=>{var e=JSON.parse(t.vote);if(e.vote)return!0})).length},noTotal(){return this.votes.votes.filter((t=>{var e=JSON.parse(t.vote);if(!e.vote)return!0})).length},w(){var t={};for(let e of this.weights)t[e.fields.walletAddress]=e.fields.units;return t},totalUnits(){var t=0;return Object.values(this.w).forEach((e=>t=parseInt(t)+parseInt(e))),t},wNormal(){var t=.1*this.totalUnits,e={};for(let s of this.weights)e[s.fields.walletAddress]=s.fields.units,s.fields.units>t&&(e[s.fields.walletAddress]=t);return e},yesWeight(){var t=0,e=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote&&(t=parseInt(t)+parseInt(e.wNormal[o.address]))})),t},noWeight(){var t=0,e=this;return this.votes.votes.forEach((function(s){var o=JSON.parse(s.vote);o.vote||(t=parseInt(t)+parseInt(e.wNormal[o.address]))})),t},percentageYes(){return this.totalUnits&&this.yesWeight?Math.round(this.yesWeight/this.totalUnits*100):0},percentageNo(){return this.totalUnits&&this.noWeight?Math.round(this.noWeight/this.totalUnits*100):0}}};const E=(0,D.Z)(W,[["render",U]]);var T=E;const C={class:"text-xs"};function I(t,e,s,a,r,n){const i=(0,o.up)("vue-countdown");return(0,o.wg)(),(0,o.iD)("div",C,[(0,o.Wm)(i,{time:this.time},{default:(0,o.w5)((({days:t,hours:e,minutes:s,seconds:a})=>[(0,o.Uk)(" Time Remainingï¼š"+(0,l.zw)(t)+" days, "+(0,l.zw)(e)+" hours, "+(0,l.zw)(s)+" minutes, "+(0,l.zw)(a)+" seconds. ",1)])),_:1},8,["time"])])}var O={props:["start"],computed:{startDate(){return new Date(this.start)},endDate(){const t=new Date;return t.setDate(this.startDate.getDate()+4),t},time(){var t=new Date;return this.endDate.getTime()-t.getTime()}}};const B=(0,D.Z)(O,[["render",I]]);var P=B,V=s(5869),j=s(1677),L={components:{AppFullpage:j.Z,AppShell:V.Z,AppButtonVote:z,CounterVote:T,AppCountdown:P},data(){return{colors:["white","black"],proposals:[],weights:[],types:["collect","invest","propose","sell","transfer","onboard"],loaded:!1}},computed:{},methods:{async getWeights(){try{const t=await f().get({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_URI+"/members?cache=true");this.weights=t.data}catch(t){console.log("error",t)}},getFieldLabel(t,e){for(let s of t)if(s.id==e)return s.name},async assembleProposalType(t){var e=["https://salontest-terrifickid.cloud.okteto.net/type/"+t,{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_URI+"/form/"+t+"?cache=true"],s=this;try{var o=[],l=await Promise.all(e.map((t=>f().get(t))));for(const t of Object.values(l[0].data.message.items)){var a={votes:[]};"votes"in t.fields&&(a=t.fields.votes,delete t.fields.votes);var r=await Object.entries(t.fields).map((function(t){var e=s.getFieldLabel(l[1].data.fields,t[0]);return{label:e,value:t[1]}})),n={id:t.sys.id,createdAt:t.sys.createdAt,contentType:t.sys.contentType.sys.id,votes:a,fields:r};o.push(n)}return o}catch(i){return console.error(i),[]}}},async beforeMount(){console.log("proposals load!");var t=await Promise.all(this.types.map((t=>this.assembleProposalType(t))));this.proposals=t.flat(),await this.getWeights(),this.loaded=!0,console.log("loaded!"),console.log(this.proposals)}};const Z=(0,D.Z)(L,[["render",v],["__scopeId","data-v-115861e8"]]);var M=Z}}]);
//# sourceMappingURL=ViewGovernance.7f3af097.js.map